<!DOCTYPE html>
<html>
  <head>
    <title>DOM Hierarchy Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .test-results {
        background: #f5f5f5;
        padding: 20px;
        border-radius: 5px;
        margin: 20px 0;
      }
      .test-results pre {
        background: white;
        padding: 10px;
        border-radius: 3px;
        overflow-x: auto;
        white-space: pre-wrap;
      }
      .controls {
        margin: 20px 0;
      }
      button {
        padding: 10px 20px;
        margin: 5px;
        border: none;
        border-radius: 3px;
        background: #007cba;
        color: white;
        cursor: pointer;
      }
      button:hover {
        background: #005a8b;
      }
      iframe {
        width: 100%;
        height: 600px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <h1>DOM Hierarchy Test</h1>

    <div class="controls">
      <button onclick="testCurrentPage()">Test Current Page</button>
      <button onclick="testIndexHTML()">Test index.html in iframe</button>
      <button onclick="clearResults()">Clear Results</button>
    </div>

    <div id="iframe-container" style="display: none">
      <h3>Testing index.html:</h3>
      <iframe id="test-iframe" src="index.html"></iframe>
    </div>

    <div class="test-results">
      <h3>DOM Hierarchy Results:</h3>
      <pre id="results">Click a test button to see results...</pre>
    </div>

    <script src="dom_hierarchy.js"></script>
    <script>
      function testCurrentPage() {
        try {
          const domHierarchy = new DOMHierarchy();
          const result = domHierarchy.generateHierarchy();

          document.getElementById("results").textContent = result;
          console.log(
            "Element Map:",
            Array.from(domHierarchy.elementMap.entries())
          );
        } catch (error) {
          document.getElementById("results").textContent =
            "Error: " + error.message;
          console.error("Error testing current page:", error);
        }
      }

      function testIndexHTML() {
        const iframe = document.getElementById("test-iframe");
        const container = document.getElementById("iframe-container");

        container.style.display = "block";

        iframe.onload = function () {
          try {
            const iframeDoc =
              iframe.contentDocument || iframe.contentWindow.document;

            // Inject the DOMHierarchy class into the iframe
            const script = iframeDoc.createElement("script");
            script.src = "dom_hierarchy.js";

            script.onload = function () {
              try {
                // Use the iframe's window context
                const iframeWindow = iframe.contentWindow;
                const domHierarchy = new iframeWindow.DOMHierarchy();

                const result = domHierarchy.generateHierarchy();
                document.getElementById("results").textContent = result;
                console.log(
                  "iframe Element Map:",
                  Array.from(domHierarchy.elementMap.entries())
                );
              } catch (error) {
                document.getElementById("results").textContent =
                  "Error in iframe: " + error.message;
                console.error("Error testing iframe:", error);
              }
            };

            iframeDoc.head.appendChild(script);
          } catch (error) {
            document.getElementById("results").textContent =
              "Error accessing iframe: " + error.message;
            console.error("Error accessing iframe:", error);
          }
        };

        // Reload the iframe to trigger onload
        iframe.src = iframe.src;
      }

      function clearResults() {
        document.getElementById("results").textContent =
          "Click a test button to see results...";
        document.getElementById("iframe-container").style.display = "none";
      }

      // Test the current page on load
      window.addEventListener("load", function () {
        console.log(
          "Page loaded, DOMHierarchy available:",
          typeof DOMHierarchy !== "undefined"
        );
      });
    </script>
  </body>
</html>
